<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Chiese Aperte – Scheda POI</title>

  <link rel="stylesheet" href="style.css" />

  <style>

    :root{
      --poi-icon-h: 58px;     /* ⬅️ altezza icona (prima 128) */
      --poi-name-size: 20px;  /* ⬅️ testo nome (prima 24) */
      --poi-pad-v: 6px;       /* ⬅️ padding verticale fascia bianca */
      --poi-pad-r: 10px;
      --poi-pad-l: 14px;
      --poi-top: 60px;        /* ⬅️ posizione fascia sotto al titolo */
    }

    .scheda-title {
      position: absolute;
      top: 8px;
      right: 8px;
      z-index: 1100;
      display: flex;
      justify-content: flex-end;
      pointer-events: none;
    }

    .scheda-title .header-title {
      pointer-events: auto;
    }

    .scheda-title img{
      display: block;
    }


    .poi-header{
      position: absolute;
      left: 8px;
      right: 8px;
      z-index: 1100;

      background: #ffffff;

      border-radius: 0;
      padding: var(--poi-pad-v) var(--poi-pad-r) var(--poi-pad-v) var(--poi-pad-l);
      box-shadow: 0 1px 3px rgba(0,0,0,0.10);
    }

    .poi-header-right {
      margin-left: 0;
      display: flex;
      align-items: flex-end;
      justify-content: flex-start;
      gap: 10px;
    }

    .poi-header img{
      height: var(--poi-icon-h);
      width: auto;
      display: block;
    }

    .poi-header .poi-name{
      font-weight: 700;
      font-size: var(--poi-name-size);
      line-height: 1.15;
      text-align: left;
      color: #222; /* poi sovrascritto dal JS con poi.colore */
    }

    .scheda-content{
      position: absolute;
      top: 130px;   /* ⬅️ prima 140, regola se serve */
      bottom: 80px;
      left: 8px;
      right: 8px;
      overflow: hidden;
    }

    @media (max-width: 480px) {
      :root{
        --poi-icon-h: 64px;
        --poi-name-size: 16px;
        --poi-pad-v: 7px;
        --poi-top: 58px;
      }
      .scheda-content { top: 120px; }
    }


    /* In landscape riduciamo fascia + icona + testo */
    @media (orientation: landscape){
      :root{
        --poi-icon-h: 52px;
        --poi-name-size: 18px;
        --poi-pad-v: 5px;
        --poi-top: 56px;
      }
    }

  </style>
</head>

<body>
  <div class="page">

    <div class="scheda-title">
      <img
        src="immagini/Titolo_ChieseAperte.png"
        alt="Chiese Aperte"
        class="header-title"
        id="titolo-app"
      />
    </div>

    <section class="poi-header" aria-label="Intestazione POI">
      <div class="poi-header-right">
        <img id="poiIcona" alt="Icona POI" />
        <div id="poiNome" class="poi-name">Caricamento...</div>
      </div>
    </section>

    <main class="scheda-content">
      <!-- Vuoto per ora -->
    </main>

    <footer class="footer">
      <div class="footer-logos">
        <img src="immagini/Logo3.png" alt="Logo 3" class="footer-logo" />
        <img src="immagini/Logo2.png" alt="Logo 2" class="footer-logo" />
        <img src="immagini/Logo1.png" alt="Logo 1" class="footer-logo" />
      </div>
      <img src="immagini/Footer.png" alt="Footer decorativo" class="footer-banner" />
    </footer>

  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    const poiIconaEl = document.getElementById('poiIcona');
    const poiNomeEl = document.getElementById('poiNome');

    if (!id) {
      poiNomeEl.textContent = 'POI non specificato';
      poiIconaEl.style.display = 'none';
    } else {
      fetch('pois.json?nocache=' + Date.now())
        .then(res => res.json())
        .then(punti => {
          const poi = punti.find(p => p.id === id);

          if (!poi) {
            poiNomeEl.textContent = 'POI non trovato';
            poiIconaEl.style.display = 'none';
            return;
          }

          poiNomeEl.textContent = poi.nome || '';
          poiNomeEl.style.color = poi.colore || '#222';

          if (poi.iconapoi) {
            poiIconaEl.src = poi.iconapoi;
            poiIconaEl.style.display = 'block';
          } else {
            poiIconaEl.style.display = 'none';
          }
        })
        .catch(err => {
          console.error('Errore caricamento pois.json:', err);
          poiNomeEl.textContent = 'Errore nel caricamento';
          poiIconaEl.style.display = 'none';
        });
    }

    function posizionaFasciaSottoTitolo() {
      const titolo = document.getElementById('titolo-app');
      const fascia = document.querySelector('.poi-header');
      if (!titolo || !fascia) return;

      const topTitolo = 8; // uguale al CSS (top: 8px)
      const altezzaTitolo = titolo.getBoundingClientRect().height;

      // "Incolla" la fascia al titolo (overlap di 1px per evitare righe)
      fascia.style.top = (topTitolo + altezzaTitolo - 2) + 'px';
    }

    window.addEventListener('load', posizionaFasciaSottoTitolo);
    window.addEventListener('resize', posizionaFasciaSottoTitolo);

  </script>
</body>
</html>
